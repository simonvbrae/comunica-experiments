# Comunica Experiments

Collection of various small experiments with [Comunica](https://comunica.dev/). The experiments here are not ready for actual use anywhere, and are mostly just saved in case they will turn out to be useful later. There is nothing of interest here for most people, and nothing is guaranteed to work.

## Generation of test data

The [SolidBench](https://github.com/SolidBench/SolidBench.js) benchmark can be used to generate social network test data and example queries, and serve them using [Community Solid Server](https://github.com/CommunitySolidServer/CommunitySolidServer). For example, to generate data and then serve it using the default configuration:

```
yarn run generate
yarn run serve
```

Please check the SolidBench documentation for more details, especially the dependencies, as it requires Docker for the data generation part. The generated data will end up in the `out-fragments` folder in the workspace root.

## Generation of cardinality indexes for test data

The index generator tool, that is basically a dumb script that count things and makes a lot of assumptions, is located at [tools/index-generator](tools/index-generator/) and needs to be built before use. To build and run, from the workspace root:

```
yarn run build
yarn run index
```

The tool will generate, by default, `profile/cardinalities.ttl` file under each pod, and create a link to it in the WebID document. The document contains some data about the predicate counts, as well as the overall triple count inside a pod, and unique predicates and subjects. The document uses [the VoID vocabulary](https://www.w3.org/TR/void/). For example:

```
@prefix void: <http://rdfs.org/ns/void#>.
@prefix ldbcv: <http://localhost:3000/www.ldbc.eu/ldbc_socialnet/1.0/vocabulary/>.
...

<http://localhost:3000/pods/00000000000000000065> a void:Dataset;
    void:triples 3410;
    void:distinctSubjects 471;
    void:distinctObjects 111;
    void:properties 36;
    void:propertyPartition [ a 332 ];
    void:propertyPartition [ ldbcv:id 313 ];
    void:propertyPartition [ ldbcv:creationDate 314 ];
    void:propertyPartition [ ldbcv:locationIP 313 ];
    ... etc.
```

Additionally, some of the pods appear to have Solid type indexes generated by the SolidBench tool, by the looks of it, but not all of them.

## Using the cardinality indexes when querying

For the purposes of using the cardinality indexes when querying, there is the `ActorRdfMetadataExtractCardinality` actor in `packages/` that attempts to retrieve metadata from the custom index as the URLs are being requested, keeping track of cardinalities on a dataset level. Whether a URL being requested is part of a dataset is determined by whether the URL starts with the URL of the dataset.

The query runner tool in [tools/query-runner](tools/query-runner/) attempts to automatically include this actor, by creating the query engine using [templates/config-query-cardinalities.json](templates/config-query-cardinalities.json) that should pull in the actor.

Running the query tool should work with:

```
yarn run query
```

TODO: The Solid part of the configurations attempts to force login, even when not needed. Need to fix it.

## Benchmarking with and without cardinality indexes

TODO
